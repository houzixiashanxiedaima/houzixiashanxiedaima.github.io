<!DOCTYPE html>
<html><head>
<title>Android自定义流式布局的探索</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">















  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%b5%81%e5%bc%8f%e5%b8%83%e5%b1%80" class="nav-什么是流式布局">
									什么是流式布局？
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e6%b5%81%e5%bc%8f%e5%b8%83%e5%b1%80" class="nav-如何实现流式布局">
									如何实现流式布局
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://houzixiashanxiedaima.github.io/">
            Blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://houzixiashanxiedaima.github.io/">
        <div class="single-column-header-title">Blog</div>
        
        <div class="single-column-header-subtitle">Be Free To Say Anything</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Android自定义流式布局的探索
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2016-07-28 15:19
                        </time>
                        

                        

                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            19 min
                            
                            16 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>最近在学习Android中自定义View的一些知识，为了检验成果，先来自定义一个流式布局。</p>
<h3 id="什么是流式布局">什么是流式布局？</h3>
<p><img src="http://upload-images.jianshu.io/upload_images/2524102-a4edfa75da430455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="流式布局示例1"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2524102-9b3989321f3e5db6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="流式布局示例2.png"></p>
<p>上面就是流式布局的示例，简单来说就是一些不同宽度的控件显示的时候根据自己的宽度和当前行剩余的宽度来决定是显示在当前行还是换行显示。</p>
<h3 id="如何实现流式布局">如何实现流式布局</h3>
<p>实现流式布局毫无疑问是需要自定义布局的，虽然Android官方给我们提供了Recyclerview中的瀑布流布局，但是这种效果却并不好，因为瀑布流的布局需要给定一个spanCount，也就是瀑布的列数。但是我们的流式布局是不清楚有多少列多少行的，因为这完全取决于我们的控件的宽度和整个流式布局的宽度。
自定义流式布局和自定义其他的一些ViewGroup的步骤基本是一致的：</p>
<ol>
<li>先onMeasure</li>
<li>后onLayout</li>
</ol>
<p>我们先从第一步开始</p>
<p>首先直接放出onMeasure的代码</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#008b45">onMeasure</span>(<span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>widthMeasureSpec,<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>heightMeasureSpec)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#228b22">//获取该ViewGroup的父布局为该ViewGroup推荐的宽高以及计算模式</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>sizeWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>MeasureSpec.<span style="color:#658b00">getSize</span>(widthMeasureSpec);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>sizeHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>MeasureSpec.<span style="color:#658b00">getSize</span>(heightMeasureSpec);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>modeWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>MeasureSpec.<span style="color:#658b00">getMode</span>(widthMeasureSpec);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>modeHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>MeasureSpec.<span style="color:#658b00">getMode</span>(heightMeasureSpec);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#228b22">//当该ViewGroup是wrap_content的时候，记录宽高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>layoutWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>layoutHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#228b22">//每行的宽高，宽度永远都取最大值，高度则直接相加</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>lineWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>lineHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#228b22">//遍历childView计并算childView的宽高与margin值，然后通过计算结果来确定当</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#228b22">//我们的ViewGroup设置为wrap_content时ViewGroup的宽高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#8b008b;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>childCount<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>getChildCount();<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span>&lt;<span style="color:#bbb"> </span>childCount;<span style="color:#bbb"> </span>i++)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>View<span style="color:#bbb"> </span>childView<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>getChildAt(i);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//通过ViewGroup的measureChild方法设置childView的宽高，执行完毕之后，</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//所有的childView的宽高都已经确定了。</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>measureChild(childView,<span style="color:#bbb"> </span>widthMeasureSpec,<span style="color:#bbb"> </span>heightMeasureSpec);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//获取上一步中ViewGroup设置的childView的宽高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>childWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childView.<span style="color:#658b00">getMeasuredWidth</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>childHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childView.<span style="color:#658b00">getMeasuredHeight</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//获取childView的LayoutParams</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">// 每个布局都有一种特殊的LayoutParams，</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//比如LinearLayout.LayoutParams,RelativeLayout.LayoutParams等等</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>MarginLayoutParams<span style="color:#bbb"> </span>mlp<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(MarginLayoutParams)<span style="color:#bbb"> </span>childView.<span style="color:#658b00">getLayoutParams</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//计算实际上childView的宽高(childView本身的宽高加上它的Margin值)</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>realChildWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">leftMargin</span><span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">rightMargin</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>realChildHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childHeight<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">topMargin</span><span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">bottomMargin</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//该行当前的宽度加上childView实际的宽度大于布局宽度，则换行</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">if</span><span style="color:#bbb"> </span>(lineWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>realChildWidth<span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span>sizeWidth)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//执行换行操作</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//这里layoutWidth取lineWidth和realChildWidth的最大值是因为可能会</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//出现如下的情况：</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//上一行：= = = ==(宽度为8)</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//该childView：==========(宽度&gt;8)</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>layoutWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>Math.<span style="color:#658b00">max</span>(lineWidth,<span style="color:#bbb"> </span>realChildWidth);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//当前计算的总高度累加一个realChildHeight即可</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>layoutHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>layoutHeight<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>realChildHeight;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//换行之后，新行的宽度和高度需要重新计算，此处是设置为在该行的唯一一个childView的实际宽高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>lineWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>realChildWidth;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>lineHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>realChildHeight;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>}<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">else</span><span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//宽度未超出，可以直接相加宽度</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>lineWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>lineWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>realChildWidth;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//获取最终的行高，取之前的行高和当前子View的高度</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>lineHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>Math.<span style="color:#658b00">max</span>(lineHeight,<span style="color:#bbb"> </span>realChildHeight);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">// 如果是最后一个，需要做一些处理。</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">if</span><span style="color:#bbb"> </span>(i<span style="color:#bbb"> </span>==<span style="color:#bbb"> </span>childCount<span style="color:#bbb"> </span>-<span style="color:#bbb"> </span>1)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//将当前布局的宽度和最后一行的宽度相比，取最大值</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>layoutWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>Math.<span style="color:#658b00">max</span>(lineWidth,<span style="color:#bbb"> </span>layoutWidth);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#228b22">//当前布局的行高还是简单的叠加即可</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>layoutHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>layoutHeight<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>lineHeight;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">           *  Mode 一般有三种模式：
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">           *  MeasureSpec.EXACTLY: 一般是在childView设置match_parent时或者是设置了具体的宽高时使用。
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">           *  MeasureSPec.AT_MOST: 一般是在childView设置wrap_content时使用
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">           *  MeasureSpec.UNSPECIFIC: childView想要多大都行，用的比较少，可能会在ScrollView的heightMode中见到。
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">           */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">// 下面就是判断childView的宽高时是如何设置的，如果是设置了具体的宽高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">//或者是match_parent，那就直接使用父布局给出的大小</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#228b22">// 否则就使用我们自己测量出来的宽高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>setMeasuredDimension(modeWidth<span style="color:#bbb"> </span>==<span style="color:#bbb"> </span>MeasureSpec.<span style="color:#658b00">EXACTLY</span><span style="color:#bbb"> </span>?<span style="color:#bbb"> </span>sizeWidth<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>layoutWidth,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                  </span>modeHeight<span style="color:#bbb"> </span>==<span style="color:#bbb"> </span>MeasureSpec.<span style="color:#658b00">EXACTLY</span><span style="color:#bbb"> </span>?<span style="color:#bbb"> </span>sizeHeight<span style="color:#bbb"> </span>:<span style="color:#bbb"> </span>layoutHeight);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>上面的代码注释已经非常的清楚，在onMeasure中的步骤也非常的清晰：</p>
<ol>
<li>获取父布局对流式布局的测量宽高和测量模式。</li>
<li>遍历流式布局中的childView。
<ul>
<li>测量并设置childView的宽高，执行这一步之后childView的宽高就已经确定</li>
<li>获取测量的childView的宽高和Layoutparams</li>
<li>计算实际上的childView宽高（包括margin）</li>
<li>判断childView的实际宽高+当前行的宽度是否超出流式布局的宽度
<ul>
<li>若超过，则换行[注1]</li>
<li>若未超过，则宽度累加，行高取当前行高与childView高度的最大值</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>最后一行的时候进行一些处理，获取最终的流式布局的宽和高</li>
</ul>
<p>onMeasure基本上就是这些了，接下来就是onLayout，先放代码：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">protected</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">void</span><span style="color:#bbb"> </span><span style="color:#008b45">onLayout</span>(<span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">boolean</span><span style="color:#bbb"> </span>changed,<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>l,<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>t,<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>r,<span style="color:#bbb"> </span><span style="color:#8b008b;font-weight:bold">final</span><span style="color:#bbb"> </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>b)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#228b22">//获取该布局在onMeasure函数中测量的宽度</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>flowWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>getWidth();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#228b22">//通过lineWidth和lineHeight来确定childView的位置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>lineWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>lineHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#228b22">//记录childView的left和top来确定位置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>childLeft<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>childTop<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#228b22">//遍历子控件，记录每个子view的位置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span><span style="color:#8b008b;font-weight:bold">for</span><span style="color:#bbb"> </span>(<span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>i<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0,<span style="color:#bbb"> </span>childCount<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>getChildCount();<span style="color:#bbb"> </span>i<span style="color:#bbb"> </span>&lt;<span style="color:#bbb"> </span>childCount;<span style="color:#bbb"> </span>i++)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span>View<span style="color:#bbb"> </span>childView<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>getChildAt(i);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#228b22">//获取到测量的宽和高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>childWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childView.<span style="color:#658b00">getMeasuredWidth</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>childHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childView.<span style="color:#658b00">getMeasuredHeight</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#228b22">//因为childView可能设置margin，这里要加上margin的距离</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span>MarginLayoutParams<span style="color:#bbb"> </span>mlp<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(MarginLayoutParams)<span style="color:#bbb"> </span>childView.<span style="color:#658b00">getLayoutParams</span>();<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#228b22">//判断整个childView所占的空间宽度+当前行的宽度是否大于父布局也就是我们ViewGroup的宽度</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#228b22">//若大于就进行换行处理</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#8b008b;font-weight:bold">if</span><span style="color:#bbb"> </span>(lineWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">leftMargin</span><span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>childWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">rightMargin</span><span style="color:#bbb"> </span>&gt;<span style="color:#bbb"> </span>flowWidth)<span style="color:#bbb"> </span>{<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#228b22">//换行之后，left为最左边的值</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span>childLeft<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#228b22">//换行之后，top为top+当前的行高</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span>childTop<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childTop<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>lineHeight;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#228b22">//换行之后，当前行高为换行前的行高+childView的TopMargin+childView+BottomMargin</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span>lineHeight<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>(mlp.<span style="color:#658b00">topMargin</span><span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>childHeight<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">bottomMargin</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span><span style="color:#228b22">//换行之后，当前行宽度为0</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">               </span>lineWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>0;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#228b22">//设置childView的上下左右坐标，统一处理margin</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>left<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childLeft<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">leftMargin</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>top<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>childTop<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">topMargin</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>right<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>left<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>childWidth;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#00688b;font-weight:bold">int</span><span style="color:#bbb"> </span>bottom<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>top<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>childHeight;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span>childView.<span style="color:#658b00">layout</span>(left,<span style="color:#bbb"> </span>top,<span style="color:#bbb"> </span>right,<span style="color:#bbb"> </span>bottom);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#228b22">//记录当前行的宽度</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span>lineWidth<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>lineWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>(mlp.<span style="color:#658b00">leftMargin</span><span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>childWidth<span style="color:#bbb"> </span>+<span style="color:#bbb"> </span>mlp.<span style="color:#658b00">rightMargin</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span>childLeft<span style="color:#bbb"> </span>=<span style="color:#bbb"> </span>lineWidth;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span>}<span style="color:#bbb">
</span></span></span></code></pre></div><p>onLayoutd的代码也非常的清晰：</p>
<ol>
<li>遍历childView</li>
<li>获取childView的宽高，并判断是否换行</li>
</ol>
<ul>
<li>若换行，则下一个childView的Left和下一行的width重置，行高为当前childView的实际高度，childTop则累加行高。</li>
<li>若不换行，宽度累加，行高不变。</li>
</ul>
<p>通过上面的onMeasure和onLayout之后，整个流式布局就已经基本完成，接下来我们设置布局文件：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> <span style="color:#228b22">&lt;!--  布局文件--&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#1e889b">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;RelativeLayout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">xmlns:android=</span><span style="color:#cd5555">&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">xmlns:tools=</span><span style="color:#cd5555">&#34;http://schemas.android.com/tools&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">xmlns:app=</span><span style="color:#cd5555">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">android:id=</span><span style="color:#cd5555">&#34;@+id/content_flow&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">android:layout_width=</span><span style="color:#cd5555">&#34;match_parent&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">android:layout_height=</span><span style="color:#cd5555">&#34;match_parent&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">app:layout_behavior=</span><span style="color:#cd5555">&#34;@string/appbar_scrolling_view_behavior&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">tools:showIn=</span><span style="color:#cd5555">&#34;@layout/activity_flow&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#658b00">tools:context=</span><span style="color:#cd5555">&#34;stephen.com.bugstest.FlowActivity&#34;</span><span style="color:#8b008b;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;stephen.com.bugstest.customwidgets.FlowLayout</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">android:id=</span><span style="color:#cd5555">&#34;@+id/flow_layout&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">android:layout_width=</span><span style="color:#cd5555">&#34;match_parent&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#658b00">android:layout_height=</span><span style="color:#cd5555">&#34;match_parent&#34;</span><span style="color:#8b008b;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;IT工程师&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;IT工程师&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;IT工程师&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;IT工程师&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;IT工程师&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;Welcome&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;IT工程师&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;学习ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;恋爱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;挣钱ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;努力ing&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;TextView</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">style=</span><span style="color:#cd5555">&#34;@style/text_flag_01&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#658b00">android:text=</span><span style="color:#cd5555">&#34;I thick i can&#34;</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;/stephen.com.bugstest.customwidgets.FlowLayout&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/RelativeLayout&gt;</span>
</span></span></code></pre></div><p>最终效果：
<img src="http://upload-images.jianshu.io/upload_images/2524102-ba18794a67eec0ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="最终效果图.png"></p>
<p>从上面的图中我们可以看到，每一行都是根据宽度自动换行，最终形成了流式布局。</p>
<p>在上面的说明中，我标注了一个注[1]，这里具体来说一下：
在实际的编码和测试过程中，我发现如果我们的childView宽度大于本身整个流式布局的宽度，那么整个流式布局就被破坏了。直接上图看看吧：
<img src="http://upload-images.jianshu.io/upload_images/2524102-da6b6c9312731b6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="情况1.png"></p>
<p>这种情况是只有这个childView的这一行的行距出现了问题。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2524102-33b1287cfc34db14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="情况2.png"></p>
<p>这种情况看起来好像是正常的，但是实际上是从这个childView之后的所有行高都变大了。</p>
<p>上面这两种情况的出现对应着代码中有一些微小的改动，在这里就不放出来了。针对上面的这两种情况，都尝试过解决办法，但是都失败了，可能是因为我们在onLayout中使用了行高来确定上下两行的间隔距离，而这个childView的行高要特殊一些，所以就导致出现这个问题。但是这个小问题也不用太在意，因为我们的流式布局基本上是不会碰到一个childView的宽度比整个布局的宽度还宽的。</p>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2016-07-28</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/posts/android%E6%B8%B8%E6%88%8F%E6%89%8B%E6%9F%84%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95%E4%B8%80/">
			Next<br>Android游戏手柄开发记录（一）
                </a>
                
                
                
                <a class="older-posts" href="/posts/drawerlayoutwrite-oncerun-everywhere/">
			Previous<br>DrawerLayout：Write-Once，Run-EveryWhere
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://houzixiashanxiedaima.github.io/">
    
        <div class="nav-title">
            Blog
        </div>
        
        <div class="nav-subtitle">
            Be Free To Say Anything
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bb%80%e4%b9%88%e6%98%af%e6%b5%81%e5%bc%8f%e5%b8%83%e5%b1%80" class="nav-什么是流式布局">
									什么是流式布局？
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e6%b5%81%e5%bc%8f%e5%b8%83%e5%b1%80" class="nav-如何实现流式布局">
									如何实现流式布局
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	This is a customized copyright.
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
