<!DOCTYPE html><html lang="zh-CN" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.17.1"><meta name="description" content="从理论上讲，静态网站生成器是一个好主意：它们可以自动填充您的主页、索引页面和RSS源，确保不会遗漏任何内容。然而，它们都设置了奇怪的限制。"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self'; font-src 'self' data:;"><link rel="canonical" href="https://blog.yuyins.com/reading-list/writing-my-own-static-site-generator-dyabyf/"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.yuyins.com/reading-list/writing-my-own-static-site-generator-dyabyf/"><meta property="og:title" content="为自己编写静态网站生成器"><meta property="og:description" content="从理论上讲，静态网站生成器是一个好主意：它们可以自动填充您的主页、索引页面和RSS源，确保不会遗漏任何内容。然而，它们都设置了奇怪的限制。"><meta property="og:image" content="https://blog.yuyins.com/favicon.svg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.yuyins.com/reading-list/writing-my-own-static-site-generator-dyabyf/"><meta property="twitter:title" content="为自己编写静态网站生成器"><meta property="twitter:description" content="从理论上讲，静态网站生成器是一个好主意：它们可以自动填充您的主页、索引页面和RSS源，确保不会遗漏任何内容。然而，它们都设置了奇怪的限制。"><meta property="twitter:image" content="https://blog.yuyins.com/favicon.svg"><title>为自己编写静态网站生成器</title><!-- Theme and color scheme script (runs before page loads to prevent flash) --><script>
			// 初始化配色方案 - 默认使用 stone-amber
			const colorScheme = localStorage.getItem('colorScheme') || 'stone-amber';
			document.documentElement.setAttribute('data-color', colorScheme);

			// 强制使用浅色主题
			document.documentElement.setAttribute('data-theme', 'light');
		</script><link rel="stylesheet" href="/_astro/_slug_.C4gYYCY9.css">
<style>.blog-post-container[data-astro-cid-wrgicudb]{width:100%;margin:0 auto;padding:2rem 0}.blog-post[data-astro-cid-wrgicudb]{width:100%;min-width:0;max-width:42rem;margin:0 auto}.article-header[data-astro-cid-wrgicudb]{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}.article-header[data-astro-cid-wrgicudb] h1[data-astro-cid-wrgicudb]{font-size:2rem;line-height:1.3;margin-bottom:1rem;font-weight:700;color:var(--foreground);word-break:break-word}.article-meta[data-astro-cid-wrgicudb]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--muted-foreground)}.source-tag[data-astro-cid-wrgicudb]{background-color:var(--muted);color:var(--foreground);padding:.125rem .5rem;border-radius:9999px;font-weight:500;font-size:.75rem;text-decoration:none;transition:opacity .2s}.source-tag[data-astro-cid-wrgicudb]:hover{opacity:.8}.separator[data-astro-cid-wrgicudb]{color:var(--border)}.article-content[data-astro-cid-wrgicudb]{line-height:1.8;margin-bottom:3rem;font-size:1.0625rem;color:var(--foreground)}.article-content[data-astro-cid-wrgicudb] h2{margin-top:2rem;margin-bottom:1rem;font-size:1.5rem;font-weight:600}.article-content[data-astro-cid-wrgicudb] h3{margin-top:1.5rem;margin-bottom:.75rem;font-size:1.25rem;font-weight:600}.article-content[data-astro-cid-wrgicudb] p{margin-bottom:1.25rem}.article-content[data-astro-cid-wrgicudb] a{color:var(--accent);text-decoration:underline;text-underline-offset:2px}.article-content[data-astro-cid-wrgicudb] img{max-width:100%;height:auto;border-radius:.5rem;margin:1.5rem 0}.article-content[data-astro-cid-wrgicudb] blockquote{border-left:4px solid var(--border);padding-left:1rem;margin:1.5rem 0;color:var(--muted-foreground);font-style:italic}.article-content[data-astro-cid-wrgicudb] pre{background:var(--muted);padding:1rem;border-radius:.5rem;overflow-x:auto;font-family:monospace;margin:1.5rem 0}.article-content[data-astro-cid-wrgicudb] ul,.article-content[data-astro-cid-wrgicudb] ol{padding-left:1.5rem;margin-bottom:1.25rem}.article-content[data-astro-cid-wrgicudb] li{margin-bottom:.5rem}.article-footer[data-astro-cid-wrgicudb]{padding-top:2rem;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:1.5rem;align-items:center}.action-row[data-astro-cid-wrgicudb]{display:flex;justify-content:center}.read-original-btn[data-astro-cid-wrgicudb]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background-color:var(--foreground);color:var(--background);border-radius:.5rem;font-weight:500;text-decoration:none;transition:opacity .2s}.read-original-btn[data-astro-cid-wrgicudb]:hover{opacity:.9}.back-to-list[data-astro-cid-wrgicudb]{text-align:center}.back-link[data-astro-cid-wrgicudb]{color:var(--muted-foreground);text-decoration:none;font-size:.875rem;transition:color .2s}.back-link[data-astro-cid-wrgicudb]:hover{color:var(--foreground)}
</style></head> <body data-astro-cid-sckkx6r4> <a id="skip-to-content" href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-accent focus:text-background" data-astro-cid-sckkx6r4>Skip to content</a> <header class="header" data-astro-cid-3ef6ksr2> <nav class="header-nav" aria-label="Main navigation" data-astro-cid-3ef6ksr2> <a href="/" class="header-logo" data-astro-cid-3ef6ksr2>
AstroBlog
</a> <div class="header-links" data-astro-cid-3ef6ksr2> <ul class="nav-list" data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 文章 </a> </li><li data-astro-cid-3ef6ksr2> <a href="/category" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 分类 </a> </li><li data-astro-cid-3ef6ksr2> <a href="/reading-list" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 订阅 </a> </li><li data-astro-cid-3ef6ksr2> <a href="/about" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 关于 </a> </li> </ul> <div class="header-actions" data-astro-cid-3ef6ksr2> <div id="search" data-astro-cid-otpdt6jm> <button id="search-button" class="search-toggle" aria-label="打开搜索" title="搜索 (⌘K)" data-astro-cid-otpdt6jm> <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-astro-cid-otpdt6jm> <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-astro-cid-otpdt6jm></circle> <path d="M20 20L16.5 16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-astro-cid-otpdt6jm></path> </svg> </button> <dialog id="search-dialog" class="search-modal" data-astro-cid-otpdt6jm> <div class="modal-content" data-astro-cid-otpdt6jm> <div class="modal-header" data-astro-cid-otpdt6jm> <h2 class="modal-title" data-astro-cid-otpdt6jm>搜索文章</h2> <button id="close-search" class="close-button" aria-label="关闭搜索" data-astro-cid-otpdt6jm> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-astro-cid-otpdt6jm> <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-otpdt6jm></path> </svg> </button> </div> <div id="pagefind-ui" data-astro-cid-otpdt6jm></div> </div> </dialog> </div> <script type="module">let d=!1;const c="pagefind-loaded";async function l(t=0){if(sessionStorage.getItem(c)==="true")return g(),!0;const r=document.getElementById("pagefind-ui");if(!r)return!1;r.innerHTML='<div style="padding: 2rem; text-align: center; color: var(--muted-foreground);">加载中...</div>';try{return await new Promise((o,s)=>{const a=document.createElement("script");a.src="/pagefind/pagefind-ui.js",a.onload=o,a.onerror=s,document.head.appendChild(a)}),g(),sessionStorage.setItem(c,"true"),!0}catch(i){return console.error("Failed to load search:",i),t<2?(console.log(`Retrying search load... (${t+1}/2)`),await new Promise(o=>setTimeout(o,1e3)),l(t+1)):(r&&(r.innerHTML=`
          <div style="padding: 2rem; text-align: center;">
            <p style="color: var(--muted-foreground); margin-bottom: 1rem;">搜索功能加载失败</p>
            <button id="retry-search" style="padding: 0.5rem 1rem; background: var(--accent); color: var(--accent-foreground); border: none; border-radius: 0.375rem; cursor: pointer;">
              重试
            </button>
          </div>
        `,document.getElementById("retry-search")?.addEventListener("click",()=>{sessionStorage.removeItem(c),l(0)})),!1)}}function g(){typeof PagefindUI<"u"&&(new PagefindUI({element:"#pagefind-ui",showSubResults:!0,showImages:!1,excerptLength:15,translations:{placeholder:"搜索文章...",clear_search:"清除",load_more:"加载更多",search_label:"搜索此站点",filters_label:"筛选",zero_results:"未找到结果 [SEARCH_TERM]",many_results:"找到 [COUNT] 个结果 [SEARCH_TERM]",one_result:"找到 [COUNT] 个结果 [SEARCH_TERM]",alt_search:"未找到 [SEARCH_TERM] 的结果。显示 [DIFFERENT_TERM] 的结果",search_suggestion:"未找到 [SEARCH_TERM] 的结果。尝试以下搜索：",searching:"搜索中 [SEARCH_TERM]..."}}),setTimeout(()=>{const t=document.querySelector(".pagefind-ui__search-input");t instanceof HTMLElement&&t.focus()},100))}function u(){if(d)return;d=!0;const t=document.getElementById("search-button"),n=document.getElementById("search-dialog"),r=document.getElementById("close-search");if(!t||!n||!r)return;let i=sessionStorage.getItem(c)==="true";const o=async()=>{n.showModal(),document.body.style.overflow="hidden",i?setTimeout(()=>{const e=document.querySelector(".pagefind-ui__search-input");e instanceof HTMLElement&&e.focus()},100):await l()&&(i=!0)},s=()=>{n.close(),document.body.style.overflow=""},a=e=>{e.target===n&&s()},m=e=>{e.key==="Escape"&&n.open&&s()},f=e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),n.open?s():o())};t.addEventListener("click",o),r.addEventListener("click",s),n.addEventListener("click",a),document.addEventListener("keydown",m),document.addEventListener("keydown",f),document.addEventListener("astro:before-swap",()=>{t.removeEventListener("click",o),r.removeEventListener("click",s),n.removeEventListener("click",a),document.removeEventListener("keydown",m),document.removeEventListener("keydown",f),d=!1},{once:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();document.addEventListener("astro:page-load",u);</script> <link href="/pagefind/pagefind-ui.css" rel="stylesheet">  </div> </div> </nav> </header>  <main id="main-content" data-pagefind-body class="main-content main-content--wide" data-astro-cid-sckkx6r4>  <div class="blog-post-container" data-astro-cid-wrgicudb> <article class="blog-post" data-astro-cid-wrgicudb> <header class="article-header" data-astro-cid-wrgicudb> <h1 data-astro-cid-wrgicudb>为自己编写静态网站生成器</h1> <div class="article-meta" data-astro-cid-wrgicudb> <a href="https://maurycyz.com" target="_blank" rel="noopener noreferrer" class="source-tag" data-astro-cid-wrgicudb>maurycyz.com</a> <span class="separator" data-astro-cid-wrgicudb>·</span> <time data-astro-cid-wrgicudb>2026年1月16日</time> </div> </header> <!-- 使用清洗后的安全 HTML 内容 --> <div class="article-content app-prose" data-astro-cid-wrgicudb>
<p>

<em>In principle, a static site generator is a good idea:</em>
They automatically populate your homepage, index pages and RSS feeds, making it impossible to forget anything.
</p><p>
Unlike a CMS like Wordpress, they don't add runtime cost or security vulnerabilities:
They run once to generate your site and are never exposed to the internet.
</p><p>
However, they all put weird restrictions on how you structure your site:

</p>
<p>
<em>Nearly all of them require you to write in Markdown</em>, which is common, but poorly specified and difficult to parse.
As soon as you do anything more complex then bolding a few words, it becomes a struggle to get the parser to do the right thing.
</p><p>
I recently spent way too much time trying to figure out how to stop it from link-ifying something that looked like a URL. 
</p><p>
In any case, the whole thing seems pointless:
I'm writing a <a href="/tutorials/website" target="_blank" rel="noopener noreferrer">website</a>, something that will be published exclusively on the web... so...
</p><p>
</p><h1>Why not just use HTML?</h1>
<p></p><p>
<em>Converting from Markdown</em> would make sense if HTML was super ugly, but it's not.
Here's what bolding looks like in Markdown:
</p>

<pre>
This is an <b>**important point**</b>
</pre>
<p>
... and here's the same in HTML:
</p>
<pre>
This is an &lt;b&gt;<b>important point</b>&lt;/b&gt;
</pre>
<p>
That might be harder to type on a phone keyboard, but if you're writing on a phone, you're not having a good time anyway. 
</p><p>
There are some things that suck with HTML, like manual syntax highlighting, but that sucks in any language.
Adding a whole markdown parser just to improve code blocks is overkill.
</p><p>
<em>These translation layers are fragile</em>:
The <a href="https://info.cern.ch/hypertext/WWW/TheProject.html" target="_blank" rel="noopener noreferrer">original website</a> still renders fine in modern browsers,
but there's no shortage of Wordpress blogs where all the formatting broke after a server update...
and not just a <a href="https://madebynathan.com/posts/2021-12-05-how-docker-saved-my-blog/" target="_blank" rel="noopener noreferrer">Wordpress problem</a>.
</p><p>
</p><h1>Configuration:</h1>
<p></p><p>
The Markdown thing is somewhat justifiable:
A lot of people are more comfortable with markdown then HTML.
</p><p>
<em>... but they all use weird template formats</em>, which are really entire programming languages shoved inside HTML:
complete with questionable design decisions and without nearly enough documentation.
As a result, it's very difficult to get these tools to do what you want:
</p><p>
I knew that something as simple as removing the publication date from pages that shouldn't have one 
(like the <a href="/archive" target="_blank" rel="noopener noreferrer">archives</a>)
would result in hours of googling cryptic error messages.
</p><p>
<em>Using them doesn't feel like handcrafting a website.</em>
It feels like throwing arcane bullshit at the wall and seeing what sticks. 
</p><p>
</p><h1>I'll just do it myself:</h1>
<p></p><p>
<em>Each article on my site is an HTML file</em> prefixed with a metadata block:

</p><pre>
title Example page:
date 2021-02-11
edited 2025-01-21
tag electronics
tag radiation
---

Paragraph one.
.
Paragraph two 
&lt;!-- snip --&gt;
.
... the rest of the page
</pre><p>

My program copies all files from the source tree into the destination directory.
Everything except HTML is left unchanged.
</p><p>
When it sees an HTML file:
The metadata block is parsed and saved for later.
Everything else is added to a template with the navigation bar and <a href="/misc/inline_css/" target="_blank" rel="noopener noreferrer">styles</a> and written to the output directory.
</p><p>
To make writing easier, the generator supports using a dot on it's own line:
</p><p>
</p><pre>
.
</pre>
<p></p><p>
... as a shorthand for paragraph breaks:
</p><p>
</p><pre>
&lt;/p&gt;&lt;p&gt;
</pre>
<p></p><p>
During this process, the generator also saves everything before the <span>&lt;!-- snip --&gt;</span> comment as an excerpt for the homepage.
This manual because a good excerpt should be long enough get an idea of what the post is about...
but not any longer.
</p><p>
<em>Once done with the content</em>, all the posts are sorted by date in reverse order:
The first 5 are added to the <a href="/" target="_blank" rel="noopener noreferrer">homepage</a>.
The first 20 are included in the <a href="/index.xml" target="_blank" rel="noopener noreferrer">the RSS feed</a>. 
All posts except space photos are included in the <a href="/archive/" target="_blank" rel="noopener noreferrer">archive</a> page. 
All <a href="/tags/" target="_blank" rel="noopener noreferrer">12 tags</a> get their own index pages.
</p><p>
There's also my <a href="/astro/catalog.html" target="_blank" rel="noopener noreferrer">catalog page</a> which is generated from objects tagged in photos I've taken:
The index page has a section for each astronomical catalog (i.e. NGC), with links sorted by their number in that catalog. (i.e. 5194)
Images of the same object are grouped together, and sorted by date taken.
Everything shoulds to be on one page for easy searching and browsing. 
</p><p>
<em>This would be very difficult or even impossible to do in a templateing language</em>, but is trivial with a custom site generator. 
</p><p>
<b>All of this is contained in a <a href="/mksite.c" target="_blank" rel="noopener noreferrer">single C file</a></b>:
It has no configuration files, no external assets and no weird domain-specific-language. 
The code is ~700 lines, including the template HTML.
It's something one person can understand and maintain.
</p><p>
<em>I highly recommend doing this</em>:
</p><p>
</p><ul>
<li>There will never be an update that <a href="https://www.ii.com/hugo-update-nope/" target="_blank" rel="noopener noreferrer">breaks your site</a>.
Sure, you could stay on an old version, but it's only a matter of time before you find an annoying bug.<br /><br /></li>
<li>You have complete control: Want to write pages in Emacs <a href="https://github.com/adityaathalye/shite" target="_blank" rel="noopener noreferrer">Org-mode</a>? LaTeX? AsciiDoc? Plain text? No problem.<br /><br /></li>
<li>Do you need something weird and very specific? Just add it.<br /><br /></li>
</ul>
<p></p><p>
It's not hard to write one:
It took only a few hours of work to get mine to the point it could replace <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> with it's 1000+ dependencies...
and mine is written in C: Not exactly the friendliest language. 
</p><p>

</p><h1>Switching:</h1>
<p></p><p>
<em>The longest part</em> was converting all my 100+ blog posts into the new format. 
This could have been automated, but I wanted the chance to freshen up the writing.
(... and it still took less time then configuring <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo.</a>)
</p><p>
I started this blog to get better at writing:
<b>All the posts from before 2023 are bad</b>.
</p><p>
Really, wanting to delete everything out of shame proves it's working.
But since this is <a href="/misc/starting_a_blog/" target="_blank" rel="noopener noreferrer">a blog</a>, I don't have to delete the old stuff: I can just fix all the mistakes.
</p><p>
I made sure to keep all URLs and RSS &lt;guid&gt;-s the same as the old site, so most people shouldn't notice the change. 
If something broke, please send me an email:

</p><pre>
blog@maurycyz.com
</pre><p>
</p>

				</div> <footer class="article-footer" data-astro-cid-wrgicudb> <div class="action-row" data-astro-cid-wrgicudb> <a href="https://maurycyz.com/misc/new_ssg/" target="_blank" rel="noopener noreferrer" class="read-original-btn" data-astro-cid-wrgicudb>
阅读原文 ↗
</a> </div> <div class="back-to-list" data-astro-cid-wrgicudb> <a href="/reading-list" class="back-link" data-astro-cid-wrgicudb>← 返回订阅列表</a> </div> </footer> </article> </div>  </main> <footer class="site-footer" aria-label="Site footer" data-astro-cid-sz7xmlte> <div class="footer-content" data-astro-cid-sz7xmlte> <p class="footer-text" data-astro-cid-sz7xmlte>
&copy; 2026 AstroBlog
</p> <p class="footer-text" data-astro-cid-sz7xmlte>
Built with  <a href="https://astro.build/" target="_blank" rel="noopener noreferrer" class="footer-link" data-astro-cid-sz7xmlte>
Astro
</a> </p> </div> </footer>  </body></html> 