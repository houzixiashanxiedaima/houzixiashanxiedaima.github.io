<!DOCTYPE html><html lang="zh-CN" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.17.1"><meta name="description" content="Whilst I was implementing a vendor command in git-pkgs, I noticed that not many package manager clients have native vendoring commands. Go has go mod vendor, Cargo has cargo vendor, and Bundler has bu"><meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self'; font-src 'self' data:;"><link rel="canonical" href="https://blog.yuyins.com/reading-list/lockfiles-killed-vendoring-1wd72r/"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.yuyins.com/reading-list/lockfiles-killed-vendoring-1wd72r/"><meta property="og:title" content="Lockfiles Killed Vendoring"><meta property="og:description" content="Whilst I was implementing a vendor command in git-pkgs, I noticed that not many package manager clients have native vendoring commands. Go has go mod vendor, Cargo has cargo vendor, and Bundler has bu"><meta property="og:image" content="https://blog.yuyins.com/favicon.svg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.yuyins.com/reading-list/lockfiles-killed-vendoring-1wd72r/"><meta property="twitter:title" content="Lockfiles Killed Vendoring"><meta property="twitter:description" content="Whilst I was implementing a vendor command in git-pkgs, I noticed that not many package manager clients have native vendoring commands. Go has go mod vendor, Cargo has cargo vendor, and Bundler has bu"><meta property="twitter:image" content="https://blog.yuyins.com/favicon.svg"><title>Lockfiles Killed Vendoring</title><!-- Theme and color scheme script (runs before page loads to prevent flash) --><script>
			// 初始化配色方案 - 默认使用 stone-amber
			const colorScheme = localStorage.getItem('colorScheme') || 'stone-amber';
			document.documentElement.setAttribute('data-color', colorScheme);

			// 强制使用浅色主题
			document.documentElement.setAttribute('data-theme', 'light');
		</script><link rel="stylesheet" href="/_astro/_slug_.AC5XNt97.css">
<style>.blog-post-container[data-astro-cid-wrgicudb]{width:100%;margin:0 auto;padding:2rem 0}.blog-post[data-astro-cid-wrgicudb]{width:100%;min-width:0;max-width:42rem;margin:0 auto}.article-header[data-astro-cid-wrgicudb]{margin-bottom:2rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}.article-header[data-astro-cid-wrgicudb] h1[data-astro-cid-wrgicudb]{font-size:2rem;line-height:1.3;margin-bottom:1rem;font-weight:700;color:var(--foreground);word-break:break-word}.article-meta[data-astro-cid-wrgicudb]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:var(--muted-foreground)}.source-tag[data-astro-cid-wrgicudb]{background-color:var(--muted);color:var(--foreground);padding:.125rem .5rem;border-radius:9999px;font-weight:500;font-size:.75rem;text-decoration:none;transition:opacity .2s}.source-tag[data-astro-cid-wrgicudb]:hover{opacity:.8}.separator[data-astro-cid-wrgicudb]{color:var(--border)}.article-content[data-astro-cid-wrgicudb]{line-height:1.8;margin-bottom:3rem;font-size:1.0625rem;color:var(--foreground)}.article-content[data-astro-cid-wrgicudb] h2{margin-top:2rem;margin-bottom:1rem;font-size:1.5rem;font-weight:600}.article-content[data-astro-cid-wrgicudb] h3{margin-top:1.5rem;margin-bottom:.75rem;font-size:1.25rem;font-weight:600}.article-content[data-astro-cid-wrgicudb] p{margin-bottom:1.25rem}.article-content[data-astro-cid-wrgicudb] a{color:var(--accent);text-decoration:underline;text-underline-offset:2px}.article-content[data-astro-cid-wrgicudb] img{max-width:100%;height:auto;border-radius:.5rem;margin:1.5rem 0}.article-content[data-astro-cid-wrgicudb] blockquote{border-left:4px solid var(--border);padding-left:1rem;margin:1.5rem 0;color:var(--muted-foreground);font-style:italic}.article-content[data-astro-cid-wrgicudb] pre{background:var(--muted);padding:1rem;border-radius:.5rem;overflow-x:auto;font-family:monospace;margin:1.5rem 0}.article-content[data-astro-cid-wrgicudb] ul,.article-content[data-astro-cid-wrgicudb] ol{padding-left:1.5rem;margin-bottom:1.25rem}.article-content[data-astro-cid-wrgicudb] li{margin-bottom:.5rem}.article-footer[data-astro-cid-wrgicudb]{padding-top:2rem;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:1.5rem;align-items:center}.action-row[data-astro-cid-wrgicudb]{display:flex;justify-content:center}.read-original-btn[data-astro-cid-wrgicudb]{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.5rem;background-color:var(--foreground);color:var(--background);border-radius:.5rem;font-weight:500;text-decoration:none;transition:opacity .2s}.read-original-btn[data-astro-cid-wrgicudb]:hover{opacity:.9}.back-to-list[data-astro-cid-wrgicudb]{text-align:center}.back-link[data-astro-cid-wrgicudb]{color:var(--muted-foreground);text-decoration:none;font-size:.875rem;transition:color .2s}.back-link[data-astro-cid-wrgicudb]:hover{color:var(--foreground)}
</style></head> <body data-astro-cid-sckkx6r4> <a id="skip-to-content" href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-accent focus:text-background" data-astro-cid-sckkx6r4>Skip to content</a> <header class="header" data-astro-cid-3ef6ksr2> <nav class="header-nav" aria-label="Main navigation" data-astro-cid-3ef6ksr2> <a href="/" class="header-logo" data-astro-cid-3ef6ksr2>
AstroBlog
</a> <div class="header-links" data-astro-cid-3ef6ksr2> <ul class="nav-list" data-astro-cid-3ef6ksr2> <li data-astro-cid-3ef6ksr2> <a href="/" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 文章 </a> </li><li data-astro-cid-3ef6ksr2> <a href="/category" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 分类 </a> </li><li data-astro-cid-3ef6ksr2> <a href="/reading-list" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 订阅 </a> </li><li data-astro-cid-3ef6ksr2> <a href="/about" class="nav-link" data-astro-prefetch="true" data-astro-cid-3ef6ksr2> 关于 </a> </li> </ul> <div class="header-actions" data-astro-cid-3ef6ksr2> <div id="search" data-astro-cid-otpdt6jm> <button id="search-button" class="search-toggle" aria-label="打开搜索" title="搜索 (⌘K)" data-astro-cid-otpdt6jm> <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-astro-cid-otpdt6jm> <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-astro-cid-otpdt6jm></circle> <path d="M20 20L16.5 16.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-astro-cid-otpdt6jm></path> </svg> </button> <dialog id="search-dialog" class="search-modal" data-astro-cid-otpdt6jm> <div class="modal-content" data-astro-cid-otpdt6jm> <div class="modal-header" data-astro-cid-otpdt6jm> <h2 class="modal-title" data-astro-cid-otpdt6jm>搜索文章</h2> <button id="close-search" class="close-button" aria-label="关闭搜索" data-astro-cid-otpdt6jm> <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-astro-cid-otpdt6jm> <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-otpdt6jm></path> </svg> </button> </div> <div id="pagefind-ui" data-astro-cid-otpdt6jm></div> </div> </dialog> </div> <script type="module">let d=!1;const c="pagefind-loaded";async function l(t=0){if(sessionStorage.getItem(c)==="true")return g(),!0;const r=document.getElementById("pagefind-ui");if(!r)return!1;r.innerHTML='<div style="padding: 2rem; text-align: center; color: var(--muted-foreground);">加载中...</div>';try{return await new Promise((o,s)=>{const a=document.createElement("script");a.src="/pagefind/pagefind-ui.js",a.onload=o,a.onerror=s,document.head.appendChild(a)}),g(),sessionStorage.setItem(c,"true"),!0}catch(i){return console.error("Failed to load search:",i),t<2?(console.log(`Retrying search load... (${t+1}/2)`),await new Promise(o=>setTimeout(o,1e3)),l(t+1)):(r&&(r.innerHTML=`
          <div style="padding: 2rem; text-align: center;">
            <p style="color: var(--muted-foreground); margin-bottom: 1rem;">搜索功能加载失败</p>
            <button id="retry-search" style="padding: 0.5rem 1rem; background: var(--accent); color: var(--accent-foreground); border: none; border-radius: 0.375rem; cursor: pointer;">
              重试
            </button>
          </div>
        `,document.getElementById("retry-search")?.addEventListener("click",()=>{sessionStorage.removeItem(c),l(0)})),!1)}}function g(){typeof PagefindUI<"u"&&(new PagefindUI({element:"#pagefind-ui",showSubResults:!0,showImages:!1,excerptLength:15,translations:{placeholder:"搜索文章...",clear_search:"清除",load_more:"加载更多",search_label:"搜索此站点",filters_label:"筛选",zero_results:"未找到结果 [SEARCH_TERM]",many_results:"找到 [COUNT] 个结果 [SEARCH_TERM]",one_result:"找到 [COUNT] 个结果 [SEARCH_TERM]",alt_search:"未找到 [SEARCH_TERM] 的结果。显示 [DIFFERENT_TERM] 的结果",search_suggestion:"未找到 [SEARCH_TERM] 的结果。尝试以下搜索：",searching:"搜索中 [SEARCH_TERM]..."}}),setTimeout(()=>{const t=document.querySelector(".pagefind-ui__search-input");t instanceof HTMLElement&&t.focus()},100))}function u(){if(d)return;d=!0;const t=document.getElementById("search-button"),n=document.getElementById("search-dialog"),r=document.getElementById("close-search");if(!t||!n||!r)return;let i=sessionStorage.getItem(c)==="true";const o=async()=>{n.showModal(),document.body.style.overflow="hidden",i?setTimeout(()=>{const e=document.querySelector(".pagefind-ui__search-input");e instanceof HTMLElement&&e.focus()},100):await l()&&(i=!0)},s=()=>{n.close(),document.body.style.overflow=""},a=e=>{e.target===n&&s()},m=e=>{e.key==="Escape"&&n.open&&s()},f=e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),n.open?s():o())};t.addEventListener("click",o),r.addEventListener("click",s),n.addEventListener("click",a),document.addEventListener("keydown",m),document.addEventListener("keydown",f),document.addEventListener("astro:before-swap",()=>{t.removeEventListener("click",o),r.removeEventListener("click",s),n.removeEventListener("click",a),document.removeEventListener("keydown",m),document.removeEventListener("keydown",f),d=!1},{once:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u();document.addEventListener("astro:page-load",u);</script> <link href="/pagefind/pagefind-ui.css" rel="stylesheet">  </div> </div> </nav> </header>  <main id="main-content" data-pagefind-body class="main-content main-content--wide" data-astro-cid-sckkx6r4>  <div class="blog-post-container" data-astro-cid-wrgicudb> <article class="blog-post" data-astro-cid-wrgicudb> <header class="article-header" data-astro-cid-wrgicudb> <h1 data-astro-cid-wrgicudb>Lockfiles Killed Vendoring</h1> <div class="article-meta" data-astro-cid-wrgicudb> <a href="https://nesbitt.io" target="_blank" rel="noopener noreferrer" class="source-tag" data-astro-cid-wrgicudb>nesbitt.io</a> <span class="separator" data-astro-cid-wrgicudb>·</span> <time data-astro-cid-wrgicudb>2026年2月10日</time> </div> </header> <!-- 使用清洗后的安全 HTML 内容 --> <div class="article-content app-prose" data-astro-cid-wrgicudb><p>Whilst I was implementing a <a href="https://github.com/git-pkgs/git-pkgs/pull/98" target="_blank" rel="noopener noreferrer">vendor command in git-pkgs</a>, I noticed that not many package manager clients have native vendoring commands. Go has <code>go mod vendor</code>, Cargo has <code>cargo vendor</code>, and Bundler has <code>bundle cache</code>. That’s most of the first-class support I could find, which surprised me for something that used to be the dominant way to manage dependencies. So I went looking for what happened.</p>

<h3>Vendoring under SVN</h3>

<p>Before lockfiles and registries, if you wanted reproducible builds you checked your dependencies into source control. The alternative was hoping the internet served you the same bytes tomorrow.</p>

<p>Under Subversion this worked fine. SVN checkouts only pull the current revision of the directories you ask for, leaving everything else on the server. You never download previous versions of vendored files, so a dependency updated twenty times costs you the same as one updated once. A 200MB vendor directory doesn’t slow you down if you never check it out, and CI can do the same. Most developers on a project never touched <code>vendor/</code> directly, and the cost of carrying all that third-party code was invisible to everyone who wasn’t actively updating it.</p>

<p>Rails formalized the convention with <code>vendor/</code> for third-party code and <code>lib/</code> for your own. You could even freeze the Rails framework itself into your vendor directory with <code>rake rails:freeze:gems</code>. Chris Wanstrath’s “Vendor Everything” post on <a href="https://web.archive.org/web/2007/http://errtheblog.com/posts/50-vendor-everything" target="_blank" rel="noopener noreferrer">err the blog</a> in 2007 named the philosophy, though the practice traces back to 2006. Ryan McGeary updated it for the Bundler era in 2011 with <a href="http://ryan.mcgeary.org/2011/02/09/vendor-everything-still-applies/" target="_blank" rel="noopener noreferrer">“Vendor Everything Still Applies”</a>: “Storage is cheap. You’ll thank me later when your deployments run smoothly.” Bundler’s arrival was effectively Rails admitting that physical vendoring was a dead end: pin versions in a lockfile instead. Composer made <code>vendor/</code> its default install target. The name stuck because it was already familiar.</p>

<h3>git clone</h3>

<p>Git clones the entire repository history by default. Every developer, every CI run, gets everything. A vendored dependency updated twenty times means twenty snapshots of its source tree in your .git directory, forever. Shallow clones and partial clones help, but as I wrote in <a href="/2025/12/24/package-managers-keep-using-git-as-a-database/" target="_blank" rel="noopener noreferrer">package managers keep using git as a database</a>, they’re workarounds for a problem SVN never had.</p>

<p>The weight became visible in ways it hadn’t been before: code search indexed everything in <code>vendor/</code>. GitHub’s language statistics counted vendored code unless you added <code>linguist-vendored</code> to .gitattributes. Pull requests touching <code>vendor/</code> generated walls of diff noise. The developer experience of working with a vendored codebase went from tolerable to actively painful.</p>

<p>Security tooling piled on: GitHub’s dependency graph, Dependabot, and similar tools parse lockfiles and manifests to find vulnerable dependencies. Vendored code is invisible to them unless you go out of your way to make it discoverable. The entire vulnerability scanning ecosystem assumed lockfiles won and built around that assumption, which created a feedback loop: the more teams relied on automated scanning, the more vendoring looked like a liability rather than a safety net.</p>

<h3>Lockfiles and registries</h3>

<p>Bundler shipped Gemfile.lock in 2010, one of the first lockfiles to pin exact dependency versions with enough information to reproduce an install. But the ecosystem where vendoring arguments ran hottest didn’t have one for years. npm launched in 2010 too, and you’d specify <code>^1.2.0</code> in package.json and get whatever the registry served that day.</p>

<p><a href="https://engineering.fb.com/2016/10/11/web/yarn-a-new-package-manager-for-javascript/" target="_blank" rel="noopener noreferrer">Yarn launched</a> in October 2016 with yarn.lock and content hashes from day one. npm followed with <a href="https://blog.npmjs.org/post/161081169345/v500" target="_blank" rel="noopener noreferrer">package-lock.json in npm 5.0</a> in May 2017. Once lockfiles recorded exact versions and integrity hashes (I covered the design choices in <a href="/2026/01/17/lockfile-format-design-and-tradeoffs/" target="_blank" rel="noopener noreferrer">lockfile format design and tradeoffs</a>), you got reproducible builds without storing the code. The lockfile records what to fetch, the registry serves it, and the hash proves nothing changed in transit.</p>

<p>Lockfiles spread to every major ecosystem. The <a href="/2025/11/15/package-manager-timeline" target="_blank" rel="noopener noreferrer">package manager timeline</a> shows them arriving in waves: Bundler in 2010, Cargo.lock with Rust in 2015, Yarn and npm in 2016-2017, Poetry and uv bringing proper lockfiles to Python. Each one made vendoring less necessary for that community.</p>

<h3>left-pad</h3>

<p>In March 2016, a developer <a href="https://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm" target="_blank" rel="noopener noreferrer">unpublished the 11-line left-pad package</a> from npm and broke builds across the ecosystem, including React and Babel. The immediate reaction was a rush back toward vendoring. If the registry can just delete packages, how can you trust it?</p>

<p>The long-term response went the other way: npm <a href="https://docs.npmjs.com/policies/unpublish" target="_blank" rel="noopener noreferrer">tightened its unpublish policy</a>. Lockfiles with content hashes meant even a re-uploaded package with different code would be caught. And enterprise proxy caches like <a href="https://jfrog.com/artifactory/" target="_blank" rel="noopener noreferrer">Artifactory</a> filled the remaining availability gap: a local mirror that your builds pull from, still serving packages even when the upstream registry goes down or a maintainer rage-quits. The availability guarantee of vendoring, without anything in your git history.</p>

<p>left-pad is sometimes framed as vindication for vendoring. I think it was the moment the industry decided to <a href="/2025/12/22/package-registries-are-governance-as-a-service/" target="_blank" rel="noopener noreferrer">fix registry governance</a> rather than abandon registries altogether.</p>

<h3>The C-shaped hole</h3>

<p>C never went through this transition because it never had the prerequisites: no dominant language package manager, no central registry that everyone publishes to, and no lockfile format. A lockfile is just a pointer to something in a registry, and if there’s no reliable registry to point to, you have to bring the code with you.</p>

<p>As I wrote in <a href="/2026/01/27/the-c-shaped-hole-in-package-management/" target="_blank" rel="noopener noreferrer">The C-Shaped Hole in Package Management</a>, developers are still dropping .c and .h files into source trees the way they have since the 1970s. Libraries like SQLite and stb are distributed as single files specifically to make this easy. Conan and vcpkg exist now, but neither has the cultural ubiquity that would make vendoring unnecessary. Without a registry everyone agrees on, vendoring in C remains the path of least resistance.</p>

<h3>Go and the Google problem</h3>

<p>Go was one of the last major languages to move past vendoring, and the reason traces straight back to Google. Go was designed at Google, by Google engineers, for Google’s development workflow. Google runs a monorepo and prizes hermetic builds: every build must be fully reproducible from what’s in the repository, with zero outside dependencies. Vendoring is how you get hermeticity, so all third-party code lives in the repository alongside first-party code, maintained by dedicated teams and managed by advanced tooling.</p>

<p>So Go shipped without a real package manager. <code>go get</code> fetched the latest commit from a repository with no versions, no lockfiles, and no registry. Russ Cox later acknowledged this in his <a href="https://research.swtch.com/vgo" target="_blank" rel="noopener noreferrer">Go += Package Versioning</a> series: “It was clear in the very first discussions of goinstall [in 2010] that we needed to do something about versioning. Unfortunately, it was not clear… exactly what to do.” They didn’t experience the pain internally because Google’s monorepo doesn’t need versions, since everything builds at head.</p>

<p>The community filled the gap with godep, glide, and dep, and all of them used a <code>vendor/</code> directory. <a href="https://go.googlesource.com/proposal/+/master/design/25719-go15vendor.md" target="_blank" rel="noopener noreferrer">Go 1.5 formalized vendoring support</a> in 2015, blessing what everyone was already doing. For five years, vendoring was the official answer.</p>

<p>Go modules arrived in Go 1.11 in 2018 with go.mod and go.sum. But the piece that actually replaced vendoring came later: the module proxy at proxy.golang.org and the checksum database at sum.golang.org. Russ Cox argued in <a href="https://research.swtch.com/vgo-module" target="_blank" rel="noopener noreferrer">Defining Go Modules</a> that the proxy made vendor directories “almost entirely redundant.” The proxy caches modules indefinitely and the sum database verifies integrity, so together they provide monorepo-level guarantees to people who don’t have a monorepo: if the source disappears, the proxy still has it; if the code changes, the checksum catches it.</p>

<p>As of this writing, Kubernetes still vendors its dependencies, a large project with the discipline to keep vendored code current, the same discipline Google has in its monorepo. Most teams don’t have that discipline, and for them, vendored dependencies go stale quietly until someone discovers a CVE six versions behind.</p>

<h3>Nix and Guix</h3>

<p>Nix and Guix take the idea in a different direction. They do something that looks a lot like vendoring but with different mechanics, and they go further than anyone else ever did. Nix doesn’t just vendor your libraries but the entire build closure: the library, the compiler that built it, the linker, the kernel headers. Every input gets copied into a content-addressed store, pinned by hash. A Nix <code>flake.lock</code> file pins exact input revisions and gets committed to the repository, while <code>nix build</code> fetches everything into <code>/nix/store</code> where it lives alongside every other version of every other package, isolated and immutable.</p>

<p>It’s hermeticity without the monorepo. You get offline builds, exact reproducibility, and a verifiable record of what went into your project. But the code lives in the Nix store rather than your repository, so you don’t pay the git history cost that made traditional vendoring painful. The tradeoff is complexity: you need to buy into Nix’s model of the world, and the learning curve is steep.</p>

<p>If the vendoring instinct was always about control (knowing exactly what code you’re running, not depending on a registry being up and honest), then Nix is where that instinct ended up for the people who took it the most seriously.</p></div> <footer class="article-footer" data-astro-cid-wrgicudb> <div class="action-row" data-astro-cid-wrgicudb> <a href="https://nesbitt.io/2026/02/10/lockfiles-killed-vendoring.html" target="_blank" rel="noopener noreferrer" class="read-original-btn" data-astro-cid-wrgicudb>
阅读原文 ↗
</a> </div> <div class="back-to-list" data-astro-cid-wrgicudb> <a href="/reading-list" class="back-link" data-astro-cid-wrgicudb>← 返回订阅列表</a> </div> </footer> </article> </div>  </main> <footer class="site-footer" aria-label="Site footer" data-astro-cid-sz7xmlte> <div class="footer-content" data-astro-cid-sz7xmlte> <p class="footer-text" data-astro-cid-sz7xmlte>
&copy; 2026 AstroBlog
</p> <p class="footer-text" data-astro-cid-sz7xmlte>
Built with  <a href="https://astro.build/" target="_blank" rel="noopener noreferrer" class="footer-link" data-astro-cid-sz7xmlte>
Astro
</a> </p> </div> </footer>  </body></html> 